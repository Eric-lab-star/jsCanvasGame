var u=Object.defineProperty;var l=(h,n,m)=>n in h?u(h,n,{enumerable:!0,configurable:!0,writable:!0,value:m}):h[n]=m;var t=(h,n,m)=>(l(h,typeof n!="symbol"?n+"":n,m),m);(function(){"use strict";class h{constructor(i,a,s,e){t(this,"image");t(this,"imgHeight");t(this,"imgWidth");t(this,"frames");this.image=i,this.frames=a,this.imgHeight=e,this.imgWidth=s}loadAnimationSets(){return this.frames.map(async(a,s)=>await this.mapHandler(a,s))}async mapHandler(i,a){const s=this.loadAnimation(i,a);return await Promise.all(s)}loadAnimation(i,a){const s=[];for(let e=0;e<i;e++){const d=this.createImageBitmap(e,a);s.push(d)}return s}createImageBitmap(i,a){return createImageBitmap(this.image,this.imgWidth*i,this.imgHeight*a,this.imgWidth,this.imgHeight)}}const o=class o{static getAnimationSpeed(){return o.animationSpeed}static getAnimationTick(){return o.animationTick}static setAnimationTick(i){o.animationTick+=i}static runAnimationTick(){return o.animationTick+=1/o.animationSpeed,Math.floor(o.animationTick)}};t(o,"GAME_WIDTH",1280),t(o,"GAME_HEIGHT",800),t(o,"animationSpeed",10),t(o,"animationTick",0);let n=o;function m(r,i,a){const s=Math.floor(r/i[a].length);return r-i[a].length*s}class g{constructor(i,a,s,e,d,c){t(this,"animation");t(this,"animationFrames");t(this,"imgWidth");t(this,"imgHeight");t(this,"animationState");t(this,"offscreen");t(this,"spriteImage");t(this,"ctx");t(this,"posPort");t(this,"bodyPosition",{x:n.GAME_WIDTH/2,y:n.GAME_HEIGHT/2});t(this,"shouldFlip",!1);t(this,"counter",0);this.animationFrames=s,this.animation=null,this.animationState=0,this.imgWidth=i,this.imgHeight=a,this.offscreen=e,this.spriteImage=d,this.posPort=c,this.ctx=this.offscreen.getContext("2d"),this.updatePos()}updatePos(){this.posPort.onmessage=i=>{this.setAnimationState(i.data.pos),this.bodyPosition=i.data.pos}}setAnimationState(i){if(i.x>this.bodyPosition.x+1){this.animationState=1,this.shouldFlip=!1,this.counter=0;return}if(i.x<this.bodyPosition.x-1){this.animationState=1,this.shouldFlip=!0,this.counter=0;return}if(i.y<this.bodyPosition.y-2){this.animationState=2,this.counter=0;return}if(i.y>this.bodyPosition.y+2){this.animationState=3,this.counter=0;return}Math.abs(i.x-this.bodyPosition.x)<=0&&Math.abs(i.y-this.bodyPosition.y)<=0&&(this.counter++,this.counter>4&&(this.animationState=0))}render(){this.ctx.reset();const i=m(n.runAnimationTick(),this.animation,this.animationState);this.shouldFlip?(this.ctx.scale(-1,1),this.ctx.drawImage(this.animation[this.animationState][i],-(this.bodyPosition.x+this.imgWidth/2),this.bodyPosition.y-this.imgHeight/2,this.imgWidth,this.imgHeight)):this.ctx.drawImage(this.animation[this.animationState][i],this.bodyPosition.x-this.imgWidth/2,this.bodyPosition.y-this.imgHeight/2,this.imgWidth,this.imgHeight),requestAnimationFrame(()=>this.render())}async setAnimation(){const i=new h(this.spriteImage,this.animationFrames,this.imgWidth,this.imgHeight),a=await Promise.all(i.loadAnimationSets());this.animation=a}}self.onmessage=async({data:{spriteImage:r,offscreen:i,animationFrames:a,imgWidth:s,imgHeight:e,posPort:d}})=>{const c=new g(s,e,a,i,r,d);c.animation||await c.setAnimation(),c.render()}})();
