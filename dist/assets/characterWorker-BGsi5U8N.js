var A=Object.defineProperty;var S=(r,n,o)=>n in r?A(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o;var i=(r,n,o)=>(S(r,typeof n!="symbol"?n+"":n,o),o);(function(){"use strict";class r{constructor(t,a,s,m,h){i(this,"image");i(this,"opt");i(this,"imgHeight");i(this,"imgWidth");i(this,"frames");this.image=t,this.frames=a,this.imgHeight=m,this.imgWidth=s,this.opt={resizeWidth:this.imgWidth*h,resizeHeight:this.imgHeight*h,resizeQuality:"pixelated"}}loadAnimationSets(){return this.frames.map(async(a,s)=>await this.mapHandler(a,s))}async mapHandler(t,a){const s=this.loadAnimation(t,a);return await Promise.all(s)}loadAnimation(t,a){const s=[];for(let m=0;m<t;m++){const h=this.createImageBitmap(m,a);s.push(h)}return s}createImageBitmap(t,a){return createImageBitmap(this.image,this.imgWidth*t,this.imgHeight*a,this.imgWidth,this.imgHeight,this.opt)}}class n{}i(n,"MAP_COLUMNS",40),i(n,"MAP_ROWS",25),i(n,"TILE_SIZE",32),i(n,"TILES_MAP_COLUMNS",17);const e=class e{static getAnimationSpeed(){return e.animationSpeed}static getAnimationTick(){return e.animationTick}static setAnimationTick(t){e.animationTick+=t}static runAnimationTick(){return e.animationTick+=1/e.animationSpeed,Math.floor(e.animationTick)}};i(e,"GAME_WIDTH",n.TILE_SIZE*n.MAP_COLUMNS),i(e,"GAME_HEIGHT",n.TILE_SIZE*n.MAP_ROWS),i(e,"animationSpeed",10),i(e,"animationTick",0);let o=e;function d(c,t,a){const s=Math.floor(c/t[a].length);return c-t[a].length*s}class u{constructor(t,a,s,m,h,l,g){i(this,"animation");i(this,"animationFrames");i(this,"imgWidth");i(this,"imgHeight");i(this,"animationState");i(this,"scale");i(this,"hitBox");i(this,"offscreen");i(this,"spriteImage");this.animationFrames=s,this.animation=null,this.animationState=0,this.scale=m,this.imgWidth=t,this.imgHeight=a,this.offscreen=h,this.hitBox=l,this.spriteImage=g}render(){const t=this.offscreen.getContext("2d");if(t===null)throw new Error("context is null");if(this.animation==null)throw new Error("need to set animation first");const a=d(o.runAnimationTick(),this.animation,this.animationState);t.clearRect(0,0,o.GAME_WIDTH,o.GAME_HEIGHT),t.drawImage(this.animation[this.animationState][a],this.hitBox.position.x-this.imgWidth,this.hitBox.position.y-this.imgHeight-2),requestAnimationFrame(()=>this.render())}async setAnimation(){const t=new r(this.spriteImage,this.animationFrames,this.imgWidth,this.imgHeight,this.scale),a=await Promise.all(t.loadAnimationSets());this.animation=a}}self.onmessage=async({data:{hitBox:c,spriteImage:t,offscreen:a,animationFrames:s,scale:m,imgWidth:h,imgHeight:l}})=>{const g=new u(h,l,s,m,a,c,t);await g.setAnimation(),g.render()}})();
